---
title: í”„ë ˆì„ì›Œí¬ ë§Œë“¤ê¸° V4
parent: Spring MVC
nav_order: -5
---

### 4ï¸âƒ£ &nbsp; V4

> ğŸ¤”ğŸ’­ êµ¬í˜„ì²´ ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì˜ ì½”ë“œê°€ ë‹¨ìˆœí•´ì ¸ì„œ ì¢‹ê¸´ í•œë°, í•­ìƒ ModelView ê°ì²´ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤ëŠ” ì ì´ ì¡°ê¸ˆ ë¶ˆí¸í•˜ë„¤..?

<img src="/assets/images/pages/cs/mvc/04. V4 pattern.png">
<span style="color: #808080">ì¶œì²˜: ê¹€ì˜í•œì˜ ìŠ¤í”„ë§MVC (ì¸í”„ëŸ°)</span>

ğŸ’¡ ì´ë²ˆì—ëŠ” ê° êµ¬í˜„ì²´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ë„ ê°’ì„ ë„˜ê¸¸ ìˆ˜ ìˆë„ë¡ í•˜ê³ , ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì€ ì˜¤ë¡œì§€ viewPath ë§Œ ë„˜ê¸¸ ìˆ˜ ìˆë„ë¡ ê°œì„ í•´ë³´ì !

### âš¡ï¸ &nbsp; 4-1. Controller4

- V4 ì—ì„œ ì‚¬ìš©í•  ì¸í„°í˜ì´ìŠ¤ëŠ” Model ë¡œ ì‚¬ìš©í•  Map ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ë„ë¡ í•  ê²ƒì´ë‹¤.

```java
package hello.servlet.web.frontcontroller.v4;

import java.util.Map;

public interface ControllerV4 {
    /**
     *
     * @param paramMap
     * @param model
     * @return viewName
     */
    String process(Map<String, String> paramMap, Map<String, Object> model);
}

```

### âš¡ï¸ &nbsp; 4-2. FrontControllerServletV4

- ì „ì²´ì ì¸ êµ¬ì¡°ëŠ” V3 ê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šì§€ë§Œ, V3 ì—ì„œ ê° êµ¬í˜„ì²´ ì»¨íŠ¸ë¡¤ëŸ¬ë³„ë¡œ ModelView ê°ì²´ë¥¼ ìƒì„±í•´ì•¼ í–ˆë‹¤ëŠ” ì ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ì˜¤ë¡œì§€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œë§Œ Map ê°ì²´ë¥¼ ìƒì„±í•  ê²ƒì´ë‹¤.

- ìƒì„±í•œ Map ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì„œ êµ¬í˜„ì²´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” í•´ë‹¹ íŒŒë¼ë¯¸í„°ì— ê°’ì„ put í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

```java


@WebServlet(name = "frontControllerServletV4", urlPatterns = "/front-controller/v4/*")
public class FrontControllerServletV4 extends HttpServlet {

    private Map<String, ControllerV4> controllerMap = new HashMap<>();

    public FrontControllerServletV4() {
        controllerMap.put("/front-controller/v4/members/new-form", new MemberFormControllerV4());
        controllerMap.put("/front-controller/v4/members/save", new MemberSaveControllerV4());
        controllerMap.put("/front-controller/v4/members", new MemberListControllerV4());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String requestURI = request.getRequestURI(); //ìš”ì²­ì£¼ì†Œ uri ë¥¼ ê·¸ëŒ€ë¡œ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.

        ControllerV4 controller = controllerMap.get(requestURI); //ë§µì—ì„œ í•´ë‹¹ uri ì˜ êµ¬í˜„ê°ì²´ë¥¼ êº¼ë‚´ì˜¨ë‹¤.
        if(controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND); //ì›¹ ìƒíƒœì½”ë“œë¥¼ 404ë¡œ ë°”ê¾¸ê³  ë¦¬í„´.
            return;
        }

        //íŒŒë¼ë¯¸í„°ê°’ì„ ê°€ì ¸ì™€ì„œ paramMap ì— ë„£ëŠ”ë‹¤.
        Map<String, String> paramMap = createParamMap(request);
        //ëª¨ë¸ ê°ì²´ë¥¼ ìƒì„±..
        Map<String, Object> model = new HashMap<>();
        //íŒŒë¼ë¯¸í„°ê°’(paramMap) ê³¼ ëª¨ë¸ ê°ì²´ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë„˜ê²¨ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ê²Œ í•œë‹¤.
        String viewName = controller.process(paramMap, model);

        MyView view = viewResolver(viewName);

        view.render(model, request,response);

    }

    private static MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }

    private static Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator().forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
}

```

### âš¡ï¸ &nbsp; 4-3. ê° êµ¬í˜„ì²´ ì»¨íŠ¸ë¡¤ëŸ¬ë“¤...

```java

public class MemberFormControllerV4 implements ControllerV4 {

    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        return "new-form";
    }

}

```

```java

public class MemberSaveControllerV4 implements ControllerV4 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        model.put("member", member);
        return "save-result";
    }
}
```

```java

public class MemberListControllerV4 implements ControllerV4 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        List<Member> members = memberRepository.findAll();
        model.put("members", members);
        return "members";
    }
}
```

ğŸ¤”ğŸ’­ ì•„ì£¼ ì™„ë²½í•´ì¡Œì–´! ì´ì œ ë” ì†ë³¼ ê³³ì´ ì—†ê² ëŠ”ê±¸! ( ì •ë§ ê·¸ëŸ´ê¹Œ ... ? )
