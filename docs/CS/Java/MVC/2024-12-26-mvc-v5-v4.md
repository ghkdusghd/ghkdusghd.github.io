---
title: í”„ë ˆì„ì›Œí¬ ë§Œë“¤ê¸° V5-V4
parent: Spring MVC
nav_order: -7
---

### 6ï¸âƒ£ &nbsp; V5 - V4

> ğŸ¤”ğŸ’­ ê·¸ë˜ë´¤ì V3 í•¸ë“¤ëŸ¬ë§Œ ì¶”ê°€í–ˆì–ì•„. ê°í¥ì´ ì—†ëŠ”ê±¸... â¡ï¸ V4 ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì¶”ê°€í•´ë³´ì.

### âš¡ï¸ &nbsp; 6-1. ControllerV4HandlerAdapter

- V4 í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ ì¶”ê°€í–ˆë‹¤. ê·¸ëŸ°ë° ë¬¸ì œê°€...?

- V4 ëŠ” Model Mapê°ì²´ì™€, í¼ìœ¼ë¡œë¶€í„° íŒŒë¼ë¯¸í„° ê°’ì„ ë°›ì•„ì˜¤ëŠ” ì¸ì(paramMap)ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ í•˜ê³  viewPath(String) ë¥¼ ë¦¬í„´ë°›ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ê°€ì§„ ì»¨íŠ¸ë¡¤ëŸ¬ì´ë‹¤.

- MyHandlerAdapter ì¸í„°í˜ì´ìŠ¤ì˜ ì¶”ìƒë©”ì„œë“œëŠ” ModelView íƒ€ì…ì˜ ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆë‹¤.

- ê·¸ë˜ì„œ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ì—ì„œ ë°ì´í„°ë¥¼ ModelView ê°ì²´ì— ë“¤ì–´ê°€ë„ë¡ ê°€ê³µí•´ì„œ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë„˜ê²¨ì£¼ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤. (ì´ê²ƒì´ ì–´ëŒ‘í„°ì˜ ì—­í• ì´ë‹¤ !)

```java

public class ControllerV4HandlerAdapter implements MyHandlerAdapter {
    @Override
    public boolean supports(Object handler) {
        return (handler instanceof ControllerV4);
    }

    @Override
    public ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException {

        ControllerV4 controller = (ControllerV4) handler;
        Map<String, String> paramMap = createParamMap(request);
        HashMap<String, Object> model = new HashMap<>();
        String viewName = controller.process(paramMap, model);

        ModelView mv = new ModelView(viewName);
        mv.setModel(model);

        return mv;
    }

    private static Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator().forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
}
```

### âš¡ï¸ &nbsp; 6-2. FrontControllerServletV5

- í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ìˆ˜ì •í•  ì‚¬í•­ì´ ê±°ì˜ ì—†ë‹¤.

- V4 ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì¶”ê°€í–ˆìœ¼ë‹ˆ handlerMappingMap ê³¼ handlerAdapters ì¢…ë¥˜ì•  V4 ì»¨íŠ¸ë¡¤ëŸ¬ë„ ì¶”ê°€í•´ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

```java

@WebServlet(name = "frontControllerServletV5", urlPatterns = "/front-controller/v5/*")
public class FrontControllerServletV5 extends HttpServlet {

    //ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì™€ë„ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ Object íƒ€ì…ì„ value ê°’ìœ¼ë¡œ ë„£ì—ˆë‹¤.
    private final Map<String, Object> handelerMappingMap = new HashMap<>();
    private final List<MyHandlerAdapter> handlerAdapters = new ArrayList<>();

    public FrontControllerServletV5() {
        initHandlerMappingMap();
        initHandlerAdapters();
    }

    private void initHandlerMappingMap() {
        handelerMappingMap.put("/front-controller/v5/v3/members/new-form", new MemberFormControllerV3());
        handelerMappingMap.put("/front-controller/v5/v3/members/save", new MemberSaveControllerV3());
        handelerMappingMap.put("/front-controller/v5/v3/members", new MemberListControllerV3());
        //V4 ì»¨íŠ¸ë¡¤ëŸ¬ ì¶”ê°€
        handelerMappingMap.put("/front-controller/v5/v4/members/new-form", new MemberFormControllerV4());
        handelerMappingMap.put("/front-controller/v5/v4/members/save", new MemberSaveControllerV4());
        handelerMappingMap.put("/front-controller/v5/v4/members", new MemberListControllerV4());
    }

    private void initHandlerAdapters() {
        //V4 í•¸ë“¤ëŸ¬ì–´ëŒ‘í„° ì¶”ê°€
        handlerAdapters.add(new ControllerV3HandlerAdapter());
        handlerAdapters.add(new ControllerV4HandlerAdapter());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String requestURI = request.getRequestURI();
        //URI(key)ê°’ì˜ value(ì»¨íŠ¸ë¡¤ëŸ¬)ë¥¼ handler ì— ì €ì¥.
        Object handler = handelerMappingMap.get(requestURI);

        if(handler == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND); //ì›¹ ìƒíƒœì½”ë“œë¥¼ 404ë¡œ ë°”ê¾¸ê³  ë¦¬í„´.
            return;
        }

        //í•´ë‹¹ í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬)ì— ë§ëŠ” ì–´ëŒ‘í„° ê°€ì ¸ì˜¤ê¸°
        MyHandlerAdapter adapter = getHandlerAdapter(handler);

        //V3 í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬)ì˜ ê²½ìš°, ModelView í˜•íƒœë¥¼ ì‚¬ìš©í•œë‹¤. í•´ë‹¹ ì–´ëŒ‘í„°ì—ì„œ ê° ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•´ì¤Œ.
        ModelView mv = adapter.handle(request, response, handler);
        //ì´í•˜ ê³¼ì •ì€ V3 íŒ¨í‚¤ì§€ ë‚´ìš©ê³¼ ë™ì¼.
        String viewName = mv.getViewName();
        MyView view = viewResolver(viewName);

        view.render(mv.getModel(), request,response);
    }

    private MyHandlerAdapter getHandlerAdapter(Object handler) {
        for (MyHandlerAdapter adapter : handlerAdapters) {
            if(adapter.supports(handler)) {
                return adapter;
            }
        }
        throw new IllegalArgumentException("handler adapterë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. handler = " + handler);
    }

    private static MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}
```

ì´ë ‡ê²Œ ìŠ¤í”„ë§ MVC ì˜ ê¸°ë³¸ êµ¬ì¡°ì™€ ìœ ì‚¬í•œ í”„ë ˆì„ì›Œí¬ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ë³´ì•˜ë‹¤. ìŠ¤í”„ë§ì€ í•¸ë“¤ëŸ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì§€ê¸ˆì˜ êµ¬ì¡°ì—ì„œ ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ì—¬ ê°„í¸í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤. ë‹¤ìŒ ì‹œê°„ë¶€í„°ëŠ” ì§„ì§œ ìŠ¤í”„ë§ MVC ì˜ êµ¬ì¡°ë¥¼ ì´í•´í•´ë³´ì.
