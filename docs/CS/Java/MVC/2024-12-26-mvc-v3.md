---
title: í”„ë ˆì„ì›Œí¬ ë§Œë“¤ê¸° V3
parent: Spring MVC
nav_order: -4
---

### 3ï¸âƒ£ &nbsp; V3

ğŸ¤”ğŸ’­ ê°€ë…ì„±ì´ ì¢€ ë‚˜ì•„ì§„ ê²ƒ ê°™ì•„. ê·¸ëŸ°ë° viewPath ì˜ "/WEB-INF/views" ê²½ë¡œëŠ” í•­ìƒ ê²¹ì¹˜ëŠ”ë° ì´ê±¸ ê³µí†µ ë¡œì§ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ì—†ì„ê¹Œ? ê·¸ë¦¬ê³  request ëŒ€ì‹  ë‹¤ë¥¸ Model ì„ ì‚¬ìš©í•˜ë©´ ì„œë¸”ë¦¿ì— ëŒ€í•œ ì¢…ì†ì„±ì„ ì—†ì•¨ ìˆ˜ ìˆì„ ê²ƒ ê°™ì€ë°...

<img src="/assets/images/pages/cs/mvc/03. V3 pattern.png">
<span style="color: #808080">ì¶œì²˜: ê¹€ì˜í•œì˜ ìŠ¤í”„ë§MVC (ì¸í”„ëŸ°)</span>

ğŸ’¡ ì´ë²ˆì—ëŠ” ê° ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Model ê³¼ viewPath ë¥¼ ë‘˜ ë‹¤ ë°˜í™˜í•˜ê²Œ í•  ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  viewPath ì—ì„œ ì¤‘ë³µë˜ëŠ” ë¶€ë¶„ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ uri ì˜ ë…¼ë¦¬ì  ë¶€ë¶„(ê° uri ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ ìµœì†Œì˜ ë°ì´í„°)ë§Œ ë„˜ê¸°ê²Œ í•  ê²ƒì´ë‹¤ !

### âš¡ï¸ &nbsp; 3-1. ModelView ì™€ MyView

- Model ê³¼ View ì—­í• ì„ ìˆ˜í–‰í•  í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

- Model ì—­í• ì„ ìˆ˜í–‰í•  ìƒˆë¡œìš´ HashMap ê°ì²´ê°€ ìƒê²¼ìœ¼ë‹ˆ V2ì—ì„œ ì‚¬ìš©í–ˆë˜ MyView í´ë˜ìŠ¤ì— render í•¨ìˆ˜ë¥¼ ì˜¤ë²„ë¡œë”© (ë§¤ê°œë³€ìˆ˜ì— Map ê°ì²´ë¥¼ ì¶”ê°€í•¨) í•˜ì—¬ ìƒˆë¡œ V3ìš© render í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

```java

public class ModelView {

    //uri ì˜ ë…¼ë¦¬ì  ë¶€ë¶„ì„ viewName ìœ¼ë¡œ ì €ì¥í•œë‹¤.
    private String viewName;
    //Model ë¡œ í™œìš©í•˜ê¸° ìœ„í•œ HashMap ê°ì²´ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.
    private Map<String, Object> model = new HashMap<>();

    //ìƒì„±ì
    public ModelView(String viewName) {
        this.viewName = viewName;
    }

    //getter setter
    public String getViewName() {
        return viewName;
    }

    public void setViewName(String viewName) {
        this.viewName = viewName;
    }

    public Map<String, Object> getModel() {
        return model;
    }

    public void setModel(Map<String, Object> model) {
        this.model = model;
    }
}
```

```java

public class MyView {

    private String viewPath;

    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }

    public void render(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }

    public void render(Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException{
        //jspëŠ” getAttributeë¡œ ê°’ì„ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— request ê°ì²´ë¡œ ê°’ì„ ì„¸íŒ…í•´ì¤˜ì•¼í•œë‹¤.
        modelToRequestAttribute(model, request);
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }

    private static void modelToRequestAttribute(Map<String, Object> model, HttpServletRequest request) {
        model.forEach((key, value) -> request.setAttribute(key, value));
    }
}
```

### âš¡ï¸ &nbsp; 3-2. ControllerV3

- ëª¨ë¸ë¡œ request ê°ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ì–´ì„œ HashMap ìœ¼ë¡œ paramMap ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ê° ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ìƒì„±ë˜ëŠ” íŒŒë¼ë¯¸í„°ê°’ì„ ë°›ì•„ì˜¤ê²Œ ë§Œë“¤ì—ˆë‹¤.

```java

public interface ControllerV3 {

    //ê·¸ê°„ Model ìš©ë„ë¡œ ì¼ë˜ request ê°ì²´ë¥¼ ëŒ€ì‹ í•˜ê¸° ìœ„í•´ paramMap ê°ì²´ë¥¼ ë§Œë“¤ì—ˆë‹¤.
    //process ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë©´ ModelView ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì§œì—¬ì§.
    ModelView process(Map<String, String> paramMap);
}
```

### âš¡ï¸ &nbsp; 3-3. FrontControllerServletV3

- uri ì™€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§¤í•‘í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ê²ƒì—ëŠ” ë³€í•¨ì´ ì—†ìœ¼ë©°, ê° ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ paramMap, viewPath ì •ë³´ë¥¼ ë‹´ì€ ModelView ê°ì²´ë¥¼ ë°˜í™˜í•˜ë©´ render í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œì„œ ë¸Œë¼ìš°ì €ë¡œ ì „ì†¡í•´ì¤€ë‹¤.

- ë˜í•œ, ë…¼ë¦¬ì  ë°ì´í„°ë§Œ ë‹´ê¸´ viewPath ì• ë’¤ë¡œ ê²½ë¡œ ë° í™•ì¥ìëª…ì„ ë‹¬ì•„ì£¼ëŠ” viewResolver ë©”ì†Œë“œë¥¼ ì¶”ê°€ë¡œ ë‹¬ì•˜ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ê²½ë¡œì˜ ìˆ˜ì •ì´ ìƒê²¨ë„ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ í•´ë‹¹ ë©”ì„œë“œ ê°’ë§Œ ë³€ê²½í•´ì£¼ë©´ ë˜ì–´ ìœ ì§€ë³´ìˆ˜ì˜ í¸ì˜ì„±ì´ ë†’ì•„ì§„ë‹¤.

```java

@WebServlet(name = "frontControllerServletV3", urlPatterns = "/front-controller/v3/*")
public class FrontControllerServletV3 extends HttpServlet {

    private Map<String, ControllerV3> controllerMap = new HashMap<>();

    public FrontControllerServletV3() {
        controllerMap.put("/front-controller/v3/members/new-form", new MemberFormControllerV3());
        controllerMap.put("/front-controller/v3/members/save", new MemberSaveControllerV3());
        controllerMap.put("/front-controller/v3/members", new MemberListControllerV3());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String requestURI = request.getRequestURI();

        ControllerV3 controller = controllerMap.get(requestURI);
        if(controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        //paramMap ì„ ë„˜ê²¨ì¤˜ì•¼ í•¨
        //request getparameterNames ë¡œ username, age ë¥¼ ê°€ì ¸ì˜´.
        //iteratorë¡œ ëŒë¦¬ë©´ì„œ keyì— name, valueì— íŒŒë¼ë¯¸í„°ê°’ì„ paramMapì— ë„£ì–´ì¤Œ.
        Map<String, String> paramMap = createParamMap(request);
        ModelView mv = controller.process(paramMap);

        String viewName = mv.getViewName();//ì—¬ê¸°ì—ëŠ” ë…¼ë¦¬ ì´ë¦„ë§Œ ë“¤ì–´ìˆë‹¤ (new-form)
        //ê·¸ë˜ì„œ ì•ì— ê²½ë¡œë¥¼ ì¶”ê°€í•´ì¤€ë‹¤. ì»´í“¨í„°ê°€ ì°¾ì•„ê°ˆ ìˆ˜ ìˆë„ë¡ !
        MyView view = viewResolver(viewName);

        //ì´ë²ˆì—ëŠ” request ê°ì²´ë¡œ íŒŒë¼ë¯¸í„°ê°’ì„ ë„˜ê²¨ì¤„ ìˆ˜ ì—†ì–´ì„œ Model ê°ì²´ë¥¼ ë„˜ê²¨ì¤€ë‹¤.
        view.render(mv.getModel(), request,response);

    }

    private static MyView viewResolver(String viewName) {
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }

    private static Map<String, String> createParamMap(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator().forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
}
```

### âš¡ï¸ &nbsp; 3-4. êµ¬í˜„ì²´ ì»¨íŠ¸ë¡¤ëŸ¬ë“¤...

```java

public class MemberFormControllerV3 implements ControllerV3 {

    @Override
    public ModelView process(Map<String, String> paramMap) {
        return new ModelView("new-form");
    }

}

```

```java

public class MemberSaveControllerV3 implements ControllerV3 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public ModelView process(Map<String, String> paramMap) {
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        ModelView mv = new ModelView("save-result");
        mv.getModel().put("member", member);
        return mv;
    }
}
```

```java

public class MemberListControllerV3 implements ControllerV3 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public ModelView process(Map<String, String> paramMap) {
        //findAll() ë©”ì„œë“œëŠ” Member ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì½”ë“œë¥¼ ì§°ë‹¤. (ë©¤ë²„ê°ì²´ì˜ í•„ë“œê°’ì€ id, username, age ê°€ ìˆìŒ)
        List<Member> members = memberRepository.findAll();

        //modelView ê°ì²´ mv ë¥¼ ìƒì„± (ìƒì„±ìë¡œ viewName í•„ë“œê°’ì— members ê°€ ë“¤ì–´ê°„ë‹¤. ì´ê²Œ jspê²½ë¡œê°€ ëœë‹¤.)
        ModelView mv = new ModelView("members");

        //mv.getModel() : modelView ê°ì²´ì˜ í•„ë“œì¸ model (Map<String, Object>) ì„ ë°›ì•„ì˜¨ë‹¤.
        //Map í˜•íƒœì˜ ìë£Œêµ¬ì¡°ì´ë¯€ë¡œ put ë©”ì„œë“œë¡œ keyê°’ : members, valueê°’ : members ë¼ëŠ” ì´ë¦„ì˜ List íƒ€ì… ë°ì´í„°ë¥¼ ë„£ëŠ”ë‹¤.
        mv.getModel().put("members", members);

        //ì´ë ‡ê²Œ ë˜ë©´ mvê°ì²´ì—ëŠ” ëª¨ë“  Member ê°ì²´ê°€ ë“¤ì–´ê°€ê²Œ ëœë‹¤. ì´ê²ƒì„ ë¦¬í„´í•œë‹¤.
        return mv;
    }
}
```

ğŸ¤”ğŸ’­ êµ¬í˜„ì²´ ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì˜ ì½”ë“œê°€ ë‹¨ìˆœí•´ì ¸ì„œ ì¢‹ê¸´ í•œë°, í•­ìƒ ModelView ê°ì²´ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤ëŠ” ì ì´ ì¡°ê¸ˆ ë¶ˆí¸í•˜ë„¤..?
